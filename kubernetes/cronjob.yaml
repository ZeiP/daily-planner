apiVersion: v1
kind: Namespace
metadata:
  name: daily-planner
---
apiVersion: batch/v1
kind: CronJob
metadata:
  name: daily-planner-cron
  namespace: daily-planner
spec:
  schedule: "0 4 * * *"
  concurrencyPolicy: Forbid
  jobTemplate:
    spec:
      template:
        spec:
          containers:
          - name: daily-planner
            image: ghcr.io/zeip/daily-planner:latest
            imagePullPolicy: IfNotPresent
            env:
            # CalDAV Configuration
            - name: PLANNER_CALDAV_URL
              valueFrom:
                secretKeyRef:
                  name: caldav-secrets
                  key: url
            - name: PLANNER_CALDAV_USERNAME
              valueFrom:
                secretKeyRef:
                  name: caldav-secrets
                  key: username
            - name: PLANNER_CALDAV_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: caldav-secrets
                  key: password
            
            # Tracks Configuration
            - name: PLANNER_TRACKS_URL
              valueFrom:
                secretKeyRef:
                  name: tracks-secrets
                  key: url
            - name: PLANNER_TRACKS_USERNAME
              valueFrom:
                secretKeyRef:
                  name: tracks-secrets
                  key: username
            - name: PLANNER_TRACKS_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: tracks-secrets
                  key: password

            # reMarkable Configuration
            - name: RMAPI_CONFIG_CONTENT
              valueFrom:
                secretKeyRef:
                  name: remarkable-secrets
                  key: rmapi_config_content
            
            # Optional General Config (can be set directly or via ConfigMap if needed)
            - name: PLANNER_TIMEZONE
              value: "Europe/Helsinki"
            
            resources:
              requests:
                memory: "128Mi"
                cpu: "100m"
              limits:
                memory: "256Mi"
                cpu: "500m"
          
          restartPolicy: OnFailure
